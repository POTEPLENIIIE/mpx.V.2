{"ast":null,"code":"import { EventEmitter } from \"@angular/core\";\nimport { HttpHeaders } from \"@angular/common/http\";\nimport { CommonModule } from \"@angular/common\";\nimport { environment } from \"src/environments/environment\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nconst _c0 = [\"fileInput\"];\nfunction AvatarUploadComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\", 5)(1, \"button\", 6);\n    i0.…µ…µlistener(\"click\", function AvatarUploadComponent_div_3_Template_button_click_1_listener() {\n      i0.…µ…µrestoreView(_r2);\n      const ctx_r2 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r2.triggerFileInput());\n    });\n    i0.…µ…µtext(2, \"\\u0417\\u0430\\u0432\\u0430\\u043D\\u0442\\u0430\\u0436\\u0438\\u0442\\u0438 \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440\");\n    i0.…µ…µelementEnd()();\n  }\n}\nfunction AvatarUploadComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\", 7)(1, \"div\", 8)(2, \"h3\");\n    i0.…µ…µtext(3, \"\\u041F\\u043E\\u043F\\u0435\\u0440\\u0435\\u0434\\u043D\\u0456\\u0439 \\u043F\\u0435\\u0440\\u0435\\u0433\\u043B\\u044F\\u0434\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(4, \"p\", 9);\n    i0.…µ…µtext(5, \" \\u041E\\u0441\\u044C \\u044F\\u043A \\u0432\\u0438\\u0433\\u043B\\u044F\\u0434\\u0430\\u0442\\u0438\\u043C\\u0435 \\u0432\\u0430\\u0448 \\u043D\\u043E\\u0432\\u0438\\u0439 \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440. \\u042F\\u043A\\u0449\\u043E \\u0432\\u0441\\u0435 \\u0432\\u043B\\u0430\\u0448\\u0442\\u043E\\u0432\\u0443\\u0454 \\u2014 \\u043D\\u0430\\u0442\\u0438\\u0441\\u043D\\u0456\\u0442\\u044C \\\"\\u041F\\u0456\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0438\\\". \");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelement(6, \"img\", 10);\n    i0.…µ…µelementStart(7, \"div\", 11)(8, \"button\", 6);\n    i0.…µ…µlistener(\"click\", function AvatarUploadComponent_div_4_Template_button_click_8_listener() {\n      i0.…µ…µrestoreView(_r4);\n      const ctx_r2 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r2.onUploadClicked());\n    });\n    i0.…µ…µtext(9, \"\\u041F\\u0456\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0438\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(10, \"button\", 12);\n    i0.…µ…µlistener(\"click\", function AvatarUploadComponent_div_4_Template_button_click_10_listener() {\n      i0.…µ…µrestoreView(_r4);\n      const ctx_r2 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r2.cancelPreview());\n    });\n    i0.…µ…µtext(11, \" \\u0421\\u043A\\u0430\\u0441\\u0443\\u0432\\u0430\\u0442\\u0438 \");\n    i0.…µ…µelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.…µ…µnextContext();\n    i0.…µ…µadvance(6);\n    i0.…µ…µproperty(\"src\", ctx_r2.previewUrl, i0.…µ…µsanitizeUrl);\n  }\n}\nexport let AvatarUploadComponent = /*#__PURE__*/(() => {\n  class AvatarUploadComponent {\n    constructor(http) {\n      this.http = http;\n      this.avatarUpdated = new EventEmitter();\n      this.selectedFile = null;\n      this.previewUrl = null;\n    }\n    triggerFileInput() {\n      this.fileInput.nativeElement.click(); // –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ –Ω–∞ iPhone\n    }\n    onFileSelected(event) {\n      const input = event.target;\n      if (input.files && input.files[0]) {\n        const file = input.files[0];\n        this.selectedFile = file;\n        const reader = new FileReader();\n        reader.onload = () => {\n          this.previewUrl = reader.result;\n          console.log(\"üì∑ –ü—Ä–µ–≤ º—é –≥–æ—Ç–æ–≤–µ:\", this.previewUrl);\n        };\n        reader.readAsDataURL(file);\n      }\n    }\n    onUploadClicked() {\n      console.log('‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ \"–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏\" –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞!');\n      this.uploadAvatar();\n    }\n    cancelPreview() {\n      this.previewUrl = null;\n      this.selectedFile = null;\n      this.fileInput.nativeElement.value = \"\"; // –û—á–∏—â–µ–Ω–Ω—è file input\n    }\n    uploadAvatar() {\n      if (!this.selectedFile) {\n        alert(\"‚ùó –§–∞–π–ª –Ω–µ –æ–±—Ä–∞–Ω–æ\");\n        return;\n      }\n      const token = localStorage.getItem(\"token\");\n      const username = localStorage.getItem(\"username\"); // üëà —Ç—É—Ç –±–µ—Ä–µ–º–æ username\n      if (!token || !username) {\n        alert(\"‚ùó –¢–æ–∫–µ–Ω –∞–±–æ —ñ–º º—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ\");\n        return;\n      }\n      const formData = new FormData();\n      formData.append(\"avatar\", this.selectedFile);\n      formData.append(\"username\", username); // üëà –û–ë–û–í º–Ø–ó–ö–û–í–û –ø–µ—Ä–µ–¥–∞—î–º–æ username\n      const headers = new HttpHeaders().set(\"Authorization\", `Bearer ${token}`);\n      this.http.post(`${environment.apiUrl}/profile/avatar`, formData, {\n        headers\n      }).subscribe({\n        next: res => {\n          console.log(\"‚úÖ –£—Å–ø—ñ—Ö:\", res);\n          this.avatarUpdated.emit(res.avatar);\n          this.selectedFile = null;\n          this.previewUrl = null;\n        },\n        error: err => {\n          console.error(\"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ:\", err);\n        }\n      });\n    }\n    static {\n      this.…µfac = function AvatarUploadComponent_Factory(t) {\n        return new (t || AvatarUploadComponent)(i0.…µ…µdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.…µcmp = /*@__PURE__*/i0.…µ…µdefineComponent({\n        type: AvatarUploadComponent,\n        selectors: [[\"app-avatar-upload\"]],\n        viewQuery: function AvatarUploadComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.…µ…µviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.…µ…µqueryRefresh(_t = i0.…µ…µloadQuery()) && (ctx.fileInput = _t.first);\n          }\n        },\n        outputs: {\n          avatarUpdated: \"avatarUpdated\"\n        },\n        standalone: true,\n        features: [i0.…µ…µStandaloneFeature],\n        decls: 5,\n        vars: 2,\n        consts: [[\"fileInput\", \"\"], [1, \"avatar-upload-container\"], [\"type\", \"file\", \"accept\", \".jpg,.jpeg\", \"hidden\", \"\", 3, \"change\"], [\"class\", \"upload-section\", 4, \"ngIf\"], [\"class\", \"preview-section\", 4, \"ngIf\"], [1, \"upload-section\"], [3, \"click\"], [1, \"preview-section\"], [1, \"popup-box\"], [1, \"info-text\"], [\"alt\", \"\\u041F\\u0440\\u0435\\u0432\\u02BC\\u044E\", 1, \"avatar-preview\", 3, \"src\"], [1, \"popup-buttons\"], [\"type\", \"button\", 1, \"cancel-btn\", 3, \"click\"]],\n        template: function AvatarUploadComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.…µ…µgetCurrentView();\n            i0.…µ…µelementStart(0, \"div\", 1)(1, \"input\", 2, 0);\n            i0.…µ…µlistener(\"change\", function AvatarUploadComponent_Template_input_change_1_listener($event) {\n              i0.…µ…µrestoreView(_r1);\n              return i0.…µ…µresetView(ctx.onFileSelected($event));\n            });\n            i0.…µ…µelementEnd();\n            i0.…µ…µtemplate(3, AvatarUploadComponent_div_3_Template, 3, 0, \"div\", 3)(4, AvatarUploadComponent_div_4_Template, 12, 1, \"div\", 4);\n            i0.…µ…µelementEnd();\n          }\n          if (rf & 2) {\n            i0.…µ…µadvance(3);\n            i0.…µ…µproperty(\"ngIf\", !ctx.previewUrl);\n            i0.…µ…µadvance();\n            i0.…µ…µproperty(\"ngIf\", ctx.previewUrl);\n          }\n        },\n        dependencies: [CommonModule, i2.NgIf],\n        styles: [\".avatar-upload-container[_ngcontent-%COMP%]{position:relative;text-align:center;margin-top:20px}input[type=file][_ngcontent-%COMP%]{display:none}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#22df58;color:#fff;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:.3s}button[_ngcontent-%COMP%]:hover{background-color:#1cb94b}.preview-section[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:1000;width:100vw;height:100vh;background-color:#000000a6;display:flex;justify-content:center;align-items:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}.popup-box[_ngcontent-%COMP%]{background-color:#2a2b38;padding:30px;border-radius:16px;text-align:center;max-width:90%;max-height:90%;box-shadow:0 0 30px #0009}.popup-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin-bottom:10px}.info-text[_ngcontent-%COMP%]{color:#aaa;font-size:14px;margin-bottom:20px}.avatar-preview[_ngcontent-%COMP%]{width:160px;height:160px;border-radius:50%;object-fit:cover;border:3px solid #22df58;margin-bottom:20px;box-shadow:0 0 10px #22df58}.popup-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#3f5fff}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2e48f3}.cancel-btn[_ngcontent-%COMP%]{background-color:#b96cfc}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#a24ee8}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.upload-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background-color:#3f5fff;color:#fff;border-radius:6px;font-weight:700;cursor:pointer;position:relative;overflow:hidden;text-align:center}.upload-label[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}\"]\n      });\n    }\n  }\n  return AvatarUploadComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}