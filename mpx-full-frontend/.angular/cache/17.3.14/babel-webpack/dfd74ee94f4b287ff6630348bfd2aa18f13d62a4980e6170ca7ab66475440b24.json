{"ast":null,"code":"// ✅ avatar-upload.component.ts\nimport { EventEmitter } from \"@angular/core\";\nimport { HttpHeaders } from \"@angular/common/http\";\nimport { CommonModule } from \"@angular/common\";\nimport { environment } from \"src/environments/environment\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../services/auth.service\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"fileInput\"];\nfunction AvatarUploadComponent_div_5_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.errorMessage);\n  }\n}\nfunction AvatarUploadComponent_div_5_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.successMessage);\n  }\n}\nfunction AvatarUploadComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"h3\");\n    i0.ɵɵtext(3, \"\\u041F\\u043E\\u043F\\u0435\\u0440\\u0435\\u0434\\u043D\\u0456\\u0439 \\u043F\\u0435\\u0440\\u0435\\u0433\\u043B\\u044F\\u0434\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 7);\n    i0.ɵɵtext(5, \" \\u041E\\u0441\\u044C \\u044F\\u043A \\u0432\\u0438\\u0433\\u043B\\u044F\\u0434\\u0430\\u0442\\u0438\\u043C\\u0435 \\u0432\\u0430\\u0448 \\u043D\\u043E\\u0432\\u0438\\u0439 \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440. \\u042F\\u043A\\u0449\\u043E \\u0432\\u0441\\u0435 \\u0432\\u043B\\u0430\\u0448\\u0442\\u043E\\u0432\\u0443\\u0454 \\u2014 \\u043D\\u0430\\u0442\\u0438\\u0441\\u043D\\u0456\\u0442\\u044C \\\"\\u041F\\u0456\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0438\\\". \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"img\", 8);\n    i0.ɵɵtemplate(7, AvatarUploadComponent_div_5_div_7_Template, 2, 1, \"div\", 9)(8, AvatarUploadComponent_div_5_div_8_Template, 2, 1, \"div\", 10);\n    i0.ɵɵelementStart(9, \"div\", 11)(10, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function AvatarUploadComponent_div_5_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.onUploadClicked());\n    });\n    i0.ɵɵtext(11, \"\\u041F\\u0456\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0438\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AvatarUploadComponent_div_5_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cancelPreview());\n    });\n    i0.ɵɵtext(13, \" \\u0421\\u043A\\u0430\\u0441\\u0443\\u0432\\u0430\\u0442\\u0438 \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"src\", ctx_r2.previewUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.errorMessage);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.successMessage);\n  }\n}\nexport let AvatarUploadComponent = /*#__PURE__*/(() => {\n  class AvatarUploadComponent {\n    constructor(http, auth) {\n      this.http = http;\n      this.auth = auth;\n      this.avatarUpdated = new EventEmitter();\n      this.selectedFile = null;\n      this.previewUrl = null;\n      this.errorMessage = null;\n      this.successMessage = null;\n    }\n    triggerFileInput() {\n      this.fileInput.nativeElement.click();\n    }\n    onFileSelected(event) {\n      const input = event.target;\n      if (input.files && input.files[0]) {\n        const file = input.files[0];\n        this.selectedFile = file;\n        const reader = new FileReader();\n        reader.onload = () => {\n          this.previewUrl = reader.result;\n          this.errorMessage = null;\n          this.successMessage = null;\n          document.body.classList.add(\"show-preview\");\n        };\n        reader.readAsDataURL(file);\n      }\n    }\n    cancelPreview() {\n      this.previewUrl = null;\n      this.selectedFile = null;\n      this.errorMessage = null;\n      this.successMessage = null;\n      this.fileInput.nativeElement.value = \"\";\n      document.body.classList.remove(\"show-preview\");\n    }\n    onUploadClicked() {\n      this.uploadAvatar();\n    }\n    uploadAvatar() {\n      if (!this.selectedFile) {\n        this.errorMessage = \"❗ Файл не обрано\";\n        return;\n      }\n      const token = this.auth.getToken();\n      const username = this.auth.getUsername();\n      if (!token || !username) {\n        this.errorMessage = \"❗ Токен або імʼя користувача не знайдено\";\n        return;\n      }\n      const formData = new FormData();\n      formData.append(\"avatar\", this.selectedFile);\n      formData.append(\"username\", username);\n      const headers = new HttpHeaders().set(\"Authorization\", `Bearer ${token}`);\n      this.http.post(`${environment.apiUrl}/profile/avatar`, formData, {\n        headers\n      }).subscribe({\n        next: res => {\n          this.avatarUpdated.emit(res.avatar);\n          this.selectedFile = null;\n          this.previewUrl = null;\n          this.successMessage = \"✅ Аватар успішно оновлено!\";\n          this.errorMessage = null;\n          document.body.classList.remove(\"show-preview\");\n          // Показати повідомлення в popup (мобільна підтримка)\n          setTimeout(() => {\n            this.successMessage = null;\n          }, 3000);\n        },\n        error: err => {\n          this.errorMessage = err?.error?.message || \"❌ Помилка при запиті\";\n          this.successMessage = null;\n          // Залишити повідомлення видимим на 5 секунд\n          setTimeout(() => {\n            this.errorMessage = null;\n          }, 5000);\n        }\n      });\n    }\n    static {\n      this.ɵfac = function AvatarUploadComponent_Factory(t) {\n        return new (t || AvatarUploadComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.AuthService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AvatarUploadComponent,\n        selectors: [[\"app-avatar-upload\"]],\n        viewQuery: function AvatarUploadComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileInput = _t.first);\n          }\n        },\n        outputs: {\n          avatarUpdated: \"avatarUpdated\"\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 6,\n        vars: 1,\n        consts: [[\"fileInput\", \"\"], [1, \"avatar-upload-container\"], [\"for\", \"fileInput\", 1, \"upload-label\"], [\"id\", \"fileInput\", \"type\", \"file\", \"accept\", \".jpg,.jpeg\", \"hidden\", \"\", 3, \"change\"], [\"class\", \"preview-section\", 4, \"ngIf\"], [1, \"preview-section\"], [1, \"popup-box\"], [1, \"info-text\"], [\"alt\", \"\\u041F\\u0440\\u0435\\u0432\\u02BC\\u044E\", 1, \"avatar-preview\", 3, \"src\"], [\"class\", \"error-msg\", 4, \"ngIf\"], [\"class\", \"success-msg\", 4, \"ngIf\"], [1, \"popup-buttons\"], [3, \"click\"], [\"type\", \"button\", 1, \"cancel-btn\", 3, \"click\"], [1, \"error-msg\"], [1, \"success-msg\"]],\n        template: function AvatarUploadComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"label\", 2);\n            i0.ɵɵtext(2, \"\\u0417\\u0430\\u0432\\u0430\\u043D\\u0442\\u0430\\u0436\\u0438\\u0442\\u0438 \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"input\", 3, 0);\n            i0.ɵɵlistener(\"change\", function AvatarUploadComponent_Template_input_change_3_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onFileSelected($event));\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(5, AvatarUploadComponent_div_5_Template, 14, 3, \"div\", 4);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.previewUrl);\n          }\n        },\n        dependencies: [CommonModule, i3.NgIf],\n        styles: [\".avatar-upload-container[_ngcontent-%COMP%]{position:relative;text-align:center;margin-top:20px}input[type=file][_ngcontent-%COMP%]{display:none}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#22df58;color:#fff;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:.3s;touch-action:manipulation;pointer-events:auto}button[_ngcontent-%COMP%]:hover{background-color:#1cb94b}.preview-section[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:1000;width:100vw;height:100vh;background-color:#000000a6;display:flex;justify-content:center;align-items:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out;pointer-events:auto;-webkit-overflow-scrolling:touch;touch-action:manipulation}.popup-box[_ngcontent-%COMP%]{background-color:#2a2b38;padding:30px;border-radius:16px;text-align:center;max-width:90%;max-height:90%;box-shadow:0 0 30px #0009}.popup-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin-bottom:10px}.info-text[_ngcontent-%COMP%]{color:#aaa;font-size:14px;margin-bottom:20px}.avatar-preview[_ngcontent-%COMP%]{width:160px;height:160px;border-radius:50%;object-fit:cover;border:3px solid #22df58;margin-bottom:20px;box-shadow:0 0 10px #22df58}.popup-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#3f5fff;touch-action:manipulation;pointer-events:auto}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2e48f3}.cancel-btn[_ngcontent-%COMP%]{background-color:#b96cfc}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#a24ee8}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.upload-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background-color:#3f5fff;color:#fff;border-radius:6px;font-weight:700;cursor:pointer;position:relative;overflow:hidden;text-align:center}.upload-label[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:#ff4c4c;font-weight:700;margin-top:10px;text-align:center}.success-msg[_ngcontent-%COMP%]{color:#22df58;font-weight:700;margin-top:10px;text-align:center}\"]\n      });\n    }\n  }\n  return AvatarUploadComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}