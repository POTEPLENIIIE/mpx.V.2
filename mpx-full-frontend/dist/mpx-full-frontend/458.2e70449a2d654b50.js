"use strict";(self.webpackChunkmpx_full_frontend=self.webpackChunkmpx_full_frontend||[]).push([[458],{6458:(j,f,i)=>{i.r(f),i.d(f,{ProfileComponent:()=>I});var t=i(4438),u=i(1626),c=i(177),p=i(5312),g=i(4796);const h=["fileInput"];function m(n,s){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.errorMessage)}}function v(n,s){if(1&n&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.successMessage)}}function _(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",5)(1,"div",6)(2,"h3"),t.EFF(3,"\u041f\u043e\u043f\u0435\u0440\u0435\u0434\u043d\u0456\u0439 \u043f\u0435\u0440\u0435\u0433\u043b\u044f\u0434"),t.k0s(),t.j41(4,"p",7),t.EFF(5,' \u041e\u0441\u044c \u044f\u043a \u0432\u0438\u0433\u043b\u044f\u0434\u0430\u0442\u0438\u043c\u0435 \u0432\u0430\u0448 \u043d\u043e\u0432\u0438\u0439 \u0430\u0432\u0430\u0442\u0430\u0440. \u042f\u043a\u0449\u043e \u0432\u0441\u0435 \u0432\u043b\u0430\u0448\u0442\u043e\u0432\u0443\u0454 \u2014 \u043d\u0430\u0442\u0438\u0441\u043d\u0456\u0442\u044c "\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438". '),t.k0s(),t.nrm(6,"img",8),t.DNE(7,m,2,1,"div",9)(8,v,2,1,"div",10),t.j41(9,"div",11)(10,"button",12),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onUploadClicked())}),t.EFF(11,"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438"),t.k0s(),t.j41(12,"button",13),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.cancelPreview())}),t.EFF(13," \u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438 "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(6),t.Y8G("src",e.previewUrl,t.B4B),t.R7$(),t.Y8G("ngIf",e.errorMessage),t.R7$(),t.Y8G("ngIf",e.successMessage)}}let x=(()=>{class n{constructor(e,o){this.http=e,this.auth=o,this.avatarUpdated=new t.bkB,this.selectedFile=null,this.previewUrl=null,this.errorMessage=null,this.successMessage=null}triggerFileInput(){this.fileInput.nativeElement.click()}onFileSelected(e){const o=e.target;if(o.files&&o.files[0]){const a=o.files[0];this.selectedFile=a;const r=new FileReader;r.onload=()=>{this.previewUrl=r.result,this.errorMessage=null,this.successMessage=null,document.body.classList.add("show-preview")},r.readAsDataURL(a)}}cancelPreview(){this.previewUrl=null,this.selectedFile=null,this.errorMessage=null,this.successMessage=null,this.fileInput.nativeElement.value="",document.body.classList.remove("show-preview")}onUploadClicked(){this.uploadAvatar()}uploadAvatar(){if(!this.selectedFile)return void(this.errorMessage="\u2757 \u0424\u0430\u0439\u043b \u043d\u0435 \u043e\u0431\u0440\u0430\u043d\u043e");const e=this.auth.getToken(),o=this.auth.getUsername();if(!e||!o)return void(this.errorMessage="\u2757 \u0422\u043e\u043a\u0435\u043d \u0430\u0431\u043e \u0456\u043c\u02bc\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430 \u043d\u0435 \u0437\u043d\u0430\u0439\u0434\u0435\u043d\u043e");const a=new FormData;a.append("avatar",this.selectedFile),a.append("username",o);const r=(new u.Lr).set("Authorization",`Bearer ${e}`);this.http.post(`${p.c.apiUrl}/profile/avatar`,a,{headers:r}).subscribe({next:l=>{this.avatarUpdated.emit(l.avatar),this.selectedFile=null,this.previewUrl=null,this.successMessage="\u2705 \u0410\u0432\u0430\u0442\u0430\u0440 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043e!",this.errorMessage=null,document.body.classList.remove("show-preview"),setTimeout(()=>{this.successMessage=null},3e3)},error:l=>{const d=l?.error?.message;this.errorMessage=d||"\u274c \u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0444\u043e\u0440\u043c\u0430\u0442\u0443 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f. \u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0456\u043d\u0448\u0435.",this.successMessage=null,setTimeout(()=>{this.errorMessage=null},5e3)}})}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(u.Qq),t.rXU(g.u))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-avatar-upload"]],viewQuery:function(o,a){if(1&o&&t.GBs(h,5),2&o){let r;t.mGM(r=t.lsd())&&(a.fileInput=r.first)}},outputs:{avatarUpdated:"avatarUpdated"},standalone:!0,features:[t.aNF],decls:6,vars:1,consts:[["fileInput",""],[1,"avatar-upload-container"],["for","fileInput",1,"upload-label"],["id","fileInput","type","file","accept",".jpg,.jpeg","hidden","",3,"change"],["class","preview-section",4,"ngIf"],[1,"preview-section"],[1,"popup-box"],[1,"info-text"],["alt","\u041f\u0440\u0435\u0432\u02bc\u044e",1,"avatar-preview",3,"src"],["class","error-msg",4,"ngIf"],["class","success-msg",4,"ngIf"],[1,"popup-buttons"],[3,"click"],["type","button",1,"cancel-btn",3,"click"],[1,"error-msg"],[1,"success-msg"]],template:function(o,a){if(1&o){const r=t.RV6();t.j41(0,"div",1)(1,"label",2),t.EFF(2,"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u0430\u0432\u0430\u0442\u0430\u0440"),t.k0s(),t.j41(3,"input",3,0),t.bIt("change",function(d){return t.eBV(r),t.Njj(a.onFileSelected(d))}),t.k0s(),t.DNE(5,_,14,3,"div",4),t.k0s()}2&o&&(t.R7$(5),t.Y8G("ngIf",a.previewUrl))},dependencies:[c.MD,c.bT],styles:[".avatar-upload-container[_ngcontent-%COMP%]{position:relative;text-align:center;margin-top:20px}input[type=file][_ngcontent-%COMP%]{display:none}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#22df58;color:#fff;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:.3s;touch-action:manipulation;pointer-events:auto}button[_ngcontent-%COMP%]:hover{background-color:#1cb94b}.preview-section[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:1000;width:100vw;height:100vh;background-color:#000000a6;display:flex;justify-content:center;align-items:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out;pointer-events:auto;-webkit-overflow-scrolling:touch;touch-action:manipulation}.popup-box[_ngcontent-%COMP%]{background-color:#2a2b38;padding:30px;border-radius:16px;text-align:center;max-width:90%;max-height:90%;box-shadow:0 0 30px #0009}.popup-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin-bottom:10px}.info-text[_ngcontent-%COMP%]{color:#aaa;font-size:14px;margin-bottom:20px}.avatar-preview[_ngcontent-%COMP%]{width:160px;height:160px;border-radius:50%;object-fit:cover;border:3px solid #22df58;margin-bottom:20px;box-shadow:0 0 10px #22df58}.popup-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#3f5fff;touch-action:manipulation;pointer-events:auto}.popup-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2e48f3}.cancel-btn[_ngcontent-%COMP%]{background-color:#b96cfc}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#a24ee8}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.upload-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background-color:#3f5fff;color:#fff;border-radius:6px;font-weight:700;cursor:pointer;position:relative;overflow:hidden;text-align:center}.upload-label[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:#ff4c4c;font-weight:700;margin-top:10px;text-align:center}.success-msg[_ngcontent-%COMP%]{color:#22df58;font-weight:700;margin-top:10px;text-align:center}"]})}}return n})();var b=i(8166),C=i(708);let M=(()=>{class n{constructor(e){this.http=e,this.apiUrl=`${p.c.apiUrl}/profile`}getUserProfile(){const e=localStorage.getItem("token"),o=(new u.Lr).set("Authorization",`Bearer ${e}`);return this.http.get(`${this.apiUrl}/me`,{headers:o})}uploadAvatar(e){const o=localStorage.getItem("token"),a=(new u.Lr).set("Authorization",`Bearer ${o}`);return this.http.post(`${this.apiUrl}/avatar`,e,{headers:a})}resendVerificationEmail(e){return this.http.post("/api/auth/resend-email",{email:e})}static{this.\u0275fac=function(o){return new(o||n)(t.KVO(u.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function w(n,s){if(1&n&&(t.j41(0,"div",4),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("ngClass",e.toastType),t.R7$(),t.SpI(" ",e.toastMessage,"\n")}}function P(n,s){if(1&n){const e=t.RV6();t.j41(0,"img",15),t.bIt("error",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.onAvatarLoadError())}),t.k0s()}if(2&n){const e=t.XpG(2);t.Y8G("src",e.environment.uploadBaseUrl+"/avatars/"+e.userData.avatar+"?t="+e.now,t.B4B)}}function F(n,s){1&n&&(t.j41(0,"span",16),t.EFF(1,"\u2705"),t.k0s())}function k(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",17)(1,"p"),t.EFF(2,"\u26a0\ufe0f \u0412\u0438 \u043d\u0435 \u043f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u043b\u0438 \u0441\u0432\u043e\u044e \u043f\u043e\u0448\u0442\u0443"),t.k0s(),t.j41(3,"button",18),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.resendEmail())}),t.EFF(4,"\u0412\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u0442\u0438 \u043b\u0438\u0441\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e"),t.k0s()()}}function E(n,s){if(1&n&&(t.j41(0,"div",19),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI(" ",e.errorMessage," ")}}function O(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",5)(1,"div",6),t.DNE(2,P,1,1,"img",7),t.j41(3,"app-avatar-upload",8),t.bIt("avatarUpdated",function(a){t.eBV(e);const r=t.XpG();return t.Njj(r.handleAvatarUpdate(a))}),t.k0s()(),t.j41(4,"div",9)(5,"h2"),t.EFF(6),t.k0s(),t.j41(7,"p",10),t.EFF(8,"\u041f\u0440\u043e\u0444\u0456\u043b\u044c \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430"),t.k0s(),t.j41(9,"div",11)(10,"p")(11,"strong"),t.EFF(12,"Email:"),t.k0s(),t.EFF(13),t.DNE(14,F,2,0,"span",12),t.k0s()(),t.DNE(15,k,5,0,"div",13)(16,E,2,1,"div",14),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(2),t.Y8G("ngIf",null==e.userData?null:e.userData.avatar),t.R7$(4),t.JRh(e.userData.username),t.R7$(7),t.SpI(" ",e.userData.email," "),t.R7$(),t.Y8G("ngIf",e.userData.isEmailVerified),t.R7$(),t.Y8G("ngIf",!e.userData.isEmailVerified),t.R7$(),t.Y8G("ngIf",e.errorMessage)}}function U(n,s){1&n&&(t.j41(0,"div",20)(1,"div",6),t.nrm(2,"div",21),t.k0s(),t.j41(3,"div",9),t.nrm(4,"div",22)(5,"div",23)(6,"div",24),t.k0s()())}let I=(()=>{class n{constructor(e){this.userService=e,this.userData={},this.now=Date.now(),this.errorMessage="",this.toastMessage="",this.toastType="",this.environment=p.c,this.isLoading=!0}ngOnInit(){this.getUserData()}onAvatarLoadError(){this.userData.avatar="default-avatar.webp",this.now=Date.now()}getUserData(){this.userService.getUserProfile().subscribe({next:e=>{this.userData={...e,avatar:e.avatar||"default-avatar.webp"},this.now=Date.now(),this.isLoading=!1},error:e=>{console.error("\u274c \u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u043e\u0442\u0440\u0438\u043c\u0430\u043d\u043d\u044f:",e),this.errorMessage="\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u043e\u0442\u0440\u0438\u043c\u0430\u0442\u0438 \u0434\u0430\u043d\u0456 \u043f\u0440\u043e\u0444\u0456\u043b\u044e.",this.isLoading=!1}})}handleAvatarUpdate(e){this.userData.avatar=e,this.now=Date.now(),this.showToast("\u0410\u0432\u0430\u0442\u0430\u0440 \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0443\u0441\u043f\u0456\u0448\u043d\u043e!","success")}showToast(e,o){this.toastMessage=e,this.toastType=o,clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{this.toastMessage="",this.toastType=""},4e3)}resendEmail(){this.userService.resendVerificationEmail(this.userData.email).subscribe({next:()=>{this.showToast("\u041b\u0438\u0441\u0442 \u043d\u0430 \u043f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0436\u0435\u043d\u043d\u044f \u043d\u0430\u0434\u0456\u0441\u043b\u0430\u043d\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e","success")},error:()=>{this.showToast("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u043f\u0440\u0438 \u043d\u0430\u0434\u0441\u0438\u043b\u0430\u043d\u043d\u0456 \u043b\u0438\u0441\u0442\u0430","error")}})}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(M))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-profile"]],standalone:!0,features:[t.aNF],decls:7,vars:3,consts:[["loading",""],["class","toast",3,"ngClass",4,"ngIf"],[1,"profile-wrapper"],["class","profile-card",4,"ngIf","ngIfElse"],[1,"toast",3,"ngClass"],[1,"profile-card"],[1,"avatar-section"],["alt","\u0410\u0432\u0430\u0442\u0430\u0440","class","avatar-img","id","avatarPreview",3,"src","error",4,"ngIf"],[3,"avatarUpdated"],[1,"info-section"],[1,"role-label"],[1,"info-box"],["class","email-check",4,"ngIf"],["class","verify-warning",4,"ngIf"],["class","error-message",4,"ngIf"],["alt","\u0410\u0432\u0430\u0442\u0430\u0440","id","avatarPreview",1,"avatar-img",3,"error","src"],[1,"email-check"],[1,"verify-warning"],[1,"resend-btn",3,"click"],[1,"error-message"],[1,"profile-card","loading-card"],[1,"avatar-placeholder","shimmer"],[1,"line","shimmer",2,"width","60%","height","20px","margin-bottom","12px"],[1,"line","shimmer",2,"width","100%","height","14px","margin-bottom","8px"],[1,"line","shimmer",2,"width","90%","height","14px"]],template:function(o,a){if(1&o&&(t.nrm(0,"app-navbar"),t.DNE(1,w,2,2,"div",1),t.j41(2,"section",2),t.DNE(3,O,17,6,"div",3)(4,U,7,0,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(6,"app-footer")),2&o){const r=t.sdS(5);t.R7$(),t.Y8G("ngIf",a.toastMessage),t.R7$(2),t.Y8G("ngIf",!a.isLoading)("ngIfElse",r)}},dependencies:[c.MD,c.YU,c.bT,b._,C.n,x],styles:['@charset "UTF-8";html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0;background-color:#f4f4f4;overflow-x:hidden;color:#111;font-family:Segoe UI,sans-serif}.profile-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 80px);padding:120px 20px 40px;background-color:#f4f4f4}.profile-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:20px;box-shadow:0 4px 25px #0000001a;display:flex;padding:25px;max-width:600px;width:100%;gap:20px;align-items:center;flex-wrap:wrap}.avatar-section[_ngcontent-%COMP%]{flex:0 0 140px;text-align:center}.verify-warning[_ngcontent-%COMP%]{margin-top:20px;background:#fff5e5;border-left:4px solid #ffa500;padding:12px 16px;border-radius:10px;color:#333;font-size:15px}.resend-btn[_ngcontent-%COMP%]{margin-top:10px;padding:8px 14px;background-color:#3f5fff;border:none;color:#fff;font-weight:700;border-radius:8px;cursor:pointer;transition:background .3s ease}.resend-btn[_ngcontent-%COMP%]:hover{background-color:#2d47cc}.email-check[_ngcontent-%COMP%]{margin-left:6px;color:#22df58;font-size:16px}.avatar-img[_ngcontent-%COMP%]{width:140px;height:140px;border-radius:50%;object-fit:cover;border:2.5px solid #3f5fff;transition:transform .3s ease}.avatar-img[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.info-section[_ngcontent-%COMP%]{flex:1;min-width:240px}.info-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;color:#222;margin-bottom:4px}.role-label[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:12px}.info-box[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:12px;border-radius:12px;margin-top:12px;box-shadow:inset 0 0 5px #0000000d}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#111;font-size:15px;margin:6px 0}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#3f5fff}@media (max-width: 768px){.profile-card[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center}.avatar-section[_ngcontent-%COMP%], .info-section[_ngcontent-%COMP%]{width:100%}}']})}}return n})()}}]);